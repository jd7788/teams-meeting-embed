<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åœ¨çº¿ä¼šè®® - æ‚¨çš„å…¬å¸</title>
  <!-- å¼•å…¥å®˜æ–¹ TeamsJS SDKï¼ˆv2.13.0 æ˜¯å½“å‰ç¨³å®šç‰ˆï¼‰ -->
  <script src="https://res.cdn.office.net/teams-js/2.13.0/js/teams.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    #meeting-container {
      width: 100%;
      height: calc(100vh - 100px);
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #0078d4;
    }
  </style>
</head>
<body>
  <h1>æ­£åœ¨åŠ å…¥è§†é¢‘ä¼šè®®...</h1>
  <div id="meeting-container"></div>

  <script>
    // ğŸ‘‡ æ›¿æ¢ä¸ºä½ çš„å®é™…ä¼šè®®é“¾æ¥
    const MEETING_LINK = "https://teams.microsoft.com/l/meetup-join/19%3ameeting_NTRhNTk5NTItZWIzMC00YjAzLWE4NTQtOGE0NzE4MGQ3ZmVl%40thread.v2/0?context=%7b%22Tid%22%3a%224305b9f4-4170-476e-85f7-b9925b2131c3%22%2c%22Oid%22%3a%22ca8cac15-e045-4aa7-a2a9-adbbfa234f4c%22%7d";

    async function embedMeeting() {
      try {
        // 1. åˆå§‹åŒ– Teams SDK
        await microsoftTeams.app.initialize();

        // 2. åˆ›å»ºä¼šè®®åµŒå…¥å®ä¾‹
        const meetingEmbed = microsoftTeams.meeting.createMeetingEmbed(
          document.getElementById("meeting-container"),
          {
            meetingLink: MEETING_LINK,
            locale: "zh-CN" // å¯é€‰ï¼šè®¾ç½®è¯­è¨€
          }
        );

        // 3. åŠ è½½ä¼šè®®
        await meetingEmbed.load();
        console.log("âœ… Teams ä¼šè®®å·²æˆåŠŸåµŒå…¥");

        // 4. å¯é€‰ï¼šç›‘å¬ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
        meetingEmbed.registerOnLoadHandler(() => {
          console.log("ä¼šè®®ç•Œé¢å®Œå…¨åŠ è½½");
        });

        meetingEmbed.registerBeforeUnloadHandler(() => {
          console.log("ç”¨æˆ·å³å°†ç¦»å¼€ä¼šè®®");
        });

      } catch (error) {
        console.error("âŒ åµŒå…¥å¤±è´¥:", error);
        document.body.innerHTML = `
          <h1>æ— æ³•åŠ è½½ä¼šè®®</h1>
          <p>è¯·ç¨åé‡è¯•ï¼Œæˆ–<a href="${MEETING_LINK}" target="_blank">ç‚¹å‡»æ­¤å¤„ç›´æ¥åŠ å…¥</a>ã€‚</p>
        `;
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    window.addEventListener("DOMContentLoaded", embedMeeting);
  </script>
} catch (error) {
  console.error("âŒ åµŒå…¥å¤±è´¥:", error);
  let msg = "æœªçŸ¥é”™è¯¯";
  if (error.message?.includes("anonymous")) {
    msg = "ä¼šè®®æœªå…è®¸åŒ¿åç”¨æˆ·åŠ å…¥";
  } else if (error.message?.includes("CSP") || error.message?.includes("frame")) {
    msg = "å†…å®¹å®‰å…¨ç­–ç•¥(CSP)é˜»æ­¢åŠ è½½ï¼Œè¯·æ£€æŸ¥ _headers";
  } else if (error.name === "InvalidMeetingLink") {
    msg = "ä¼šè®®é“¾æ¥æ— æ•ˆæˆ–å·²è¿‡æœŸ";
  }
  document.body.innerHTML = `
    <div style="padding: 50px; text-align: center; color: #d32f2f;">
      <h2>æ— æ³•åŠ è½½ä¼šè®®</h2>
      <p>åŸå› : ${msg}</p>
      <p>é”™è¯¯è¯¦æƒ…: ${error.message}</p>
      <a href="${MEETING_LINK}" target="_blank" style="display: inline-block; margin-top: 20px; padding: 10px 20px; background: #1890ff; color: white; text-decoration: none; border-radius: 4px;">ç›´æ¥åŠ å…¥ä¼šè®®</a>
    </div>
  `;
}
</body>
</html>



